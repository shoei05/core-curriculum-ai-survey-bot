# Claude-GLM → Codex 自動レビュー連携システム 設定完了報告書

**作成日**: 2026年1月19日

---

## 1. システム概要

Claude Code（claude-glm）がファイルを編集した際に、自動的にCodex CLIがコードレビューを実行し、結果をフィードバックするシステム。

## 2. 完了した設定

| 項目 | 状態 | パス |
|------|------|------|
| Codex CLI | インストール済み | `/usr/local/bin/codex` |
| レビュースクリプト | 作成済み | `~/.claude/scripts/codex-review.sh` |
| レビュー保存ディレクトリ | 作成済み | `~/.claude/reviews/` |
| PostToolUse Hook | 設定済み | `~/.claude/settings.json` |

## 3. 動作フロー

```
┌─────────────────┐
│  Claude-GLM     │  ファイル編集（Write/Edit）
└────────┬────────┘
         ↓
┌─────────────────┐
│  PostToolUse    │  フックがトリガー
│  Hook           │
└────────┬────────┘
         ↓
┌─────────────────┐
│  codex-review   │  Codex CLI実行
│  .sh            │
└────────┬────────┘
         ↓
┌─────────────────┐
│  レビュー結果    │  ターミナル表示 + ファイル保存
└─────────────────┘
```

## 4. ユーザー確認方法

### 4.1 レビュー結果の確認場所

1. **ターミナル**: ファイル編集後、`=== Codex Review Feedback ===` として表示
2. **ファイル**: `~/.claude/reviews/latest.md` に最新レビューが保存

### 4.2 手動での動作確認コマンド

```bash
# 最新レビュー確認
cat ~/.claude/reviews/latest.md

# レビュー履歴一覧
ls -la ~/.claude/reviews/

# スクリプト手動実行テスト
CLAUDE_TOOL_NAME="Write" \
CLAUDE_FILE_PATH="/path/to/file.py" \
~/.claude/scripts/codex-review.sh
```

## 5. レビュー対象ファイル

以下の拡張子のファイルのみレビュー対象：
- `.ts`, `.tsx`, `.js`, `.jsx`
- `.py`
- `.go`, `.rs`
- `.sh`, `.md`

## 6. 既知の制限事項

| 制限 | 詳細 |
|------|------|
| タイムアウト | 120秒（大きなファイルは時間がかかる可能性） |
| 非gitリポジトリ | `--skip-git-repo-check` で対応済み |
| Hook未動作の可能性 | Claude Code再起動で反映必要 |

## 7. トラブルシューティング

### Hookが動作しない場合

1. Claude Codeを完全に終了して再起動
2. `~/.claude/settings.json` の構文エラー確認
3. スクリプトの実行権限確認: `chmod +x ~/.claude/scripts/codex-review.sh`

### レビュー結果が空の場合

1. Codex CLIのインストール確認: `which codex`
2. Codex CLIの認証状態確認: `codex auth status`

## 8. 関連ファイル

- 仕様書: `/Users/shoei05/仕様書2.md`
- 計画書: `~/.claude/plans/harmonic-wibbling-bee.md`
- Hook設定: `~/.claude/settings.json`
- レビュースクリプト: `~/.claude/scripts/codex-review.sh`

---

**注**: PostToolUse hookの動作は、matcher設定（`Write|Edit`）の解釈に依存します。動作しない場合は、Claude Code側のhook仕様に合わせた調整が必要な可能性があります。
